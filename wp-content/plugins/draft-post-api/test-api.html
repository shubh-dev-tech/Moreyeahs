<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft Post API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        button {
            background: #0073aa;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a87;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        textarea, input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        .response {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .posts-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .post-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .post-title {
            font-weight: bold;
            color: #0073aa;
        }
        .post-meta {
            font-size: 12px;
            color: #666;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>Draft Post API Test Interface</h1>
    
    <!-- API Base URL Configuration -->
    <div class="container">
        <h2>Configuration</h2>
        <div class="form-group">
            <label for="apiBase">API Base URL:</label>
            <input type="text" id="apiBase" value="/wp-json/draft-api/v1" placeholder="Enter API base URL">
        </div>
    </div>

    <!-- Create Draft Post -->
    <div class="container">
        <h2>Create Draft Post</h2>
        <div class="form-group">
            <label for="postTitle">Title:</label>
            <input type="text" id="postTitle" placeholder="Enter post title">
        </div>
        <div class="form-group">
            <label for="postContent">Content:</label>
            <textarea id="postContent" placeholder="Enter post content (HTML allowed)"></textarea>
        </div>
        <div class="form-group">
            <label for="postExcerpt">Excerpt:</label>
            <textarea id="postExcerpt" placeholder="Enter post excerpt"></textarea>
        </div>
        <div class="form-group">
            <label for="postCategories">Categories (comma-separated):</label>
            <input type="text" id="postCategories" placeholder="Technology, Web Development">
        </div>
        <div class="form-group">
            <label for="postTags">Tags (comma-separated):</label>
            <input type="text" id="postTags" placeholder="wordpress, api, draft">
        </div>
        <button onclick="createDraftPost()">Create Draft Post</button>
        <div id="createResponse" class="response" style="display: none;"></div>
    </div>

    <!-- Get Draft Posts -->
    <div class="container">
        <h2>Get Draft Posts</h2>
        <div class="form-group">
            <label for="perPage">Posts per page:</label>
            <input type="number" id="perPage" value="10" min="1" max="100">
        </div>
        <div class="form-group">
            <label for="pageNum">Page number:</label>
            <input type="number" id="pageNum" value="1" min="1">
        </div>
        <button onclick="getDraftPosts()">Get Draft Posts</button>
        <div id="postsResponse" class="response" style="display: none;"></div>
        <div id="postsList" class="posts-list"></div>
    </div>

    <!-- Update Draft Post -->
    <div class="container">
        <h2>Update Draft Post</h2>
        <div class="form-group">
            <label for="updatePostId">Post ID:</label>
            <input type="number" id="updatePostId" placeholder="Enter post ID to update">
        </div>
        <div class="form-group">
            <label for="updateTitle">New Title:</label>
            <input type="text" id="updateTitle" placeholder="Enter new title">
        </div>
        <div class="form-group">
            <label for="updateContent">New Content:</label>
            <textarea id="updateContent" placeholder="Enter new content"></textarea>
        </div>
        <div class="form-group">
            <label for="updateStatus">Status:</label>
            <select id="updateStatus">
                <option value="draft">Draft</option>
                <option value="publish">Publish</option>
                <option value="private">Private</option>
            </select>
        </div>
        <button onclick="updateDraftPost()">Update Post</button>
        <div id="updateResponse" class="response" style="display: none;"></div>
    </div>

    <!-- Delete Draft Post -->
    <div class="container">
        <h2>Delete Draft Post</h2>
        <div class="form-group">
            <label for="deletePostId">Post ID:</label>
            <input type="number" id="deletePostId" placeholder="Enter post ID to delete">
        </div>
        <button onclick="deleteDraftPost()" style="background: #dc3545;">Delete Post</button>
        <div id="deleteResponse" class="response" style="display: none;"></div>
    </div>

    <script>
        // Get API base URL
        function getApiBase() {
            return document.getElementById('apiBase').value || '/wp-json/draft-api/v1';
        }

        // Show response in a div
        function showResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'response ' + (isError ? 'error' : 'success');
            element.textContent = JSON.stringify(data, null, 2);
        }

        // Create draft post
        async function createDraftPost() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const excerpt = document.getElementById('postExcerpt').value;
            const categories = document.getElementById('postCategories').value.split(',').map(c => c.trim()).filter(c => c);
            const tags = document.getElementById('postTags').value.split(',').map(t => t.trim()).filter(t => t);

            if (!title) {
                alert('Title is required');
                return;
            }

            const postData = {
                title: title,
                content: content,
                excerpt: excerpt,
                categories: categories,
                tags: tags
            };

            try {
                const response = await fetch(`${getApiBase()}/create-post`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(postData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResponse('createResponse', data);
                    // Clear form
                    document.getElementById('postTitle').value = '';
                    document.getElementById('postContent').value = '';
                    document.getElementById('postExcerpt').value = '';
                    document.getElementById('postCategories').value = '';
                    document.getElementById('postTags').value = '';
                } else {
                    showResponse('createResponse', data, true);
                }
            } catch (error) {
                showResponse('createResponse', { error: error.message }, true);
            }
        }

        // Get draft posts
        async function getDraftPosts() {
            const perPage = document.getElementById('perPage').value;
            const pageNum = document.getElementById('pageNum').value;

            try {
                const response = await fetch(`${getApiBase()}/draft-posts?per_page=${perPage}&page=${pageNum}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('postsResponse', {
                        total: response.headers.get('X-WP-Total'),
                        totalPages: response.headers.get('X-WP-TotalPages'),
                        posts: data.length
                    });
                    
                    // Display posts in a user-friendly format
                    const postsList = document.getElementById('postsList');
                    if (data.length === 0) {
                        postsList.innerHTML = '<p>No draft posts found.</p>';
                    } else {
                        postsList.innerHTML = data.map(post => `
                            <div class="post-item">
                                <div class="post-title">${post.title}</div>
                                <div class="post-meta">ID: ${post.id} | Status: ${post.status} | Date: ${post.date}</div>
                                <div class="post-meta">Author: ${post.author.name} | Categories: ${post.categories.map(c => c.name).join(', ')}</div>
                                <div style="margin-top: 5px;">
                                    <button onclick="fillUpdateForm(${post.id}, '${post.title.replace(/'/g, "\\'")}', '${post.content.replace(/'/g, "\\'").replace(/\n/g, '\\n')}')">Edit</button>
                                    <button onclick="fillDeleteForm(${post.id})" style="background: #dc3545;">Delete</button>
                                </div>
                            </div>
                        `).join('');
                    }
                } else {
                    showResponse('postsResponse', data, true);
                }
            } catch (error) {
                showResponse('postsResponse', { error: error.message }, true);
            }
        }

        // Fill update form with post data
        function fillUpdateForm(id, title, content) {
            document.getElementById('updatePostId').value = id;
            document.getElementById('updateTitle').value = title;
            document.getElementById('updateContent').value = content.replace(/\\n/g, '\n').replace(/\\'/g, "'");
        }

        // Fill delete form with post ID
        function fillDeleteForm(id) {
            document.getElementById('deletePostId').value = id;
        }

        // Update draft post
        async function updateDraftPost() {
            const postId = document.getElementById('updatePostId').value;
            const title = document.getElementById('updateTitle').value;
            const content = document.getElementById('updateContent').value;
            const status = document.getElementById('updateStatus').value;

            if (!postId) {
                alert('Post ID is required');
                return;
            }

            const updateData = {};
            if (title) updateData.title = title;
            if (content) updateData.content = content;
            if (status) updateData.status = status;

            try {
                const response = await fetch(`${getApiBase()}/update-post/${postId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResponse('updateResponse', data);
                } else {
                    showResponse('updateResponse', data, true);
                }
            } catch (error) {
                showResponse('updateResponse', { error: error.message }, true);
            }
        }

        // Delete draft post
        async function deleteDraftPost() {
            const postId = document.getElementById('deletePostId').value;

            if (!postId) {
                alert('Post ID is required');
                return;
            }

            if (!confirm('Are you sure you want to delete this post?')) {
                return;
            }

            try {
                const response = await fetch(`${getApiBase()}/delete-post/${postId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResponse('deleteResponse', data);
                    document.getElementById('deletePostId').value = '';
                } else {
                    showResponse('deleteResponse', data, true);
                }
            } catch (error) {
                showResponse('deleteResponse', { error: error.message }, true);
            }
        }

        // Load draft posts on page load
        window.addEventListener('load', function() {
            getDraftPosts();
        });
    </script>
</body>
</html>